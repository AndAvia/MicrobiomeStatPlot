---
title: "ArcDiagram"
author: "Defeng Bai Agricultural Genomics Institute at Shenzhen, Chinese Academy of Agricultural Sciences"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: yes
    toc_depth: 5
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo=T, comment=NA, message=F, warning=F,
	fig.align="center", fig.width=5, fig.height=3, dpi=300)
```


# 弧线图(Arc diagram)

什么是弧线图？
What is an arc diagram?

弧线图是一种特殊结构的网络图，常用于展示不同数据节点间的联系或频率。在弧线图中，节点沿单一轴线显示，节点间的链接用弧线表示。相比常规网络图，弧线图能够按需自行定义或优化每个节点的顺序，更好的突出显示群组和分支，同时还能清楚展示每个节点的文本标签。

Arc diagram is a special structure of network diagram, which is often used to show the connection or frequency between different data nodes. In the arc diagram, the nodes are displayed along a single axis, and the links between the nodes are represented by arcs. Compared with the conventional network diagram, the arc diagram can define or optimize the order of each node as needed, better highlight the groups and branches, and clearly display the text label of each node.

参考：https://mp.weixin.qq.com/s/-beK8ycxXpbKE8O0nyWpIQ

参考文献1：https://doi.org/10.1016/j.heliyon.2024.e28597
参考文献2：https://doi.org/10.1126/science.adm8762

### 弧线图案例一
Arc diagram example 1

这是成都中医药大学Nan Zeng团队2024年发表于Heliyon上的一篇论文(Bao et al., 2024)用到的图。论文题目为：Ischemic stroke pathophysiology: A bibliometric and visualization 
analysis from 1990 to 2022 

This is a picture used in a paper (Bao et al., 2024) published in Heliyon by Nan Zeng's team from Chengdu University of Traditional Chinese Medicine in 2024. The title of the paper is: Ischemic stroke pathophysiology: A bibliometric and visualization analysis from 1990 to 2022


![](e1.arcdiagram.01.jpg)

Fig. 5. Timeline visualization of co-cited references. 
图 5. 同引参考文献的时间线可视化。


**结果**
CiteSpace can be applied to conducting a statistical and correlation analysis of co-cited references into clusters. In this study, we identified eight different clusters in the network of co-cited references, with significant modularity and silhouette scores, indicating highly credible clusters (Q = 0.4463, S = 0.8224). The eight clusters are displayed in Fig. 5, including #0 Neurosciences, #1 Peripheral Vascular Disease, #2 Pharmacology & Pharmacy, #3 Medicine, General &Internal, #4 Medicine, Research & Experimental, #5 Biochemistry & Molecular Biology, #6 Multidisciplinary Sciences and #7 Radiology, Nuclear Medicine & Medical Imaging.

CiteSpace 可用于对同引文献进行统计和相关性分析，将其划分为聚类。在本研究中，我们在同引文献网络中确定了八个不同的聚类，这些聚类具有显著的模块性和轮廓得分，表明这些聚类具有很高的可信度（Q = 0.4463，S = 0.8224）。图 5 显示了八个聚类，包括 #0 神经科学、#1 外周血管疾病、#2 药理学和药学、#3 医学、综合和内科、#4 医学、研究和实验、#5 生物化学和分子生物学、#6 多学科科学和 #7 放射学、核医学和医学成像。

Besides, as shown in Fig. 5, the research clusters out of date mainly referred to #0 Neurosciences, #1 Peripheral Vascular Disease, and #6 Multidisciplinary Sciences. Popular research clusters until 2022 were #2 Pharmacology & Pharmacy, #3 Medicine, General &Internal, #5 Biochemistry & Molecular Biology, and #7 Radiology, Nuclear Medicine & Medical Imaging, which are the hotspots in the exploration of ischemic stroke pathophysiology

此外，如图 5 所示，过时的研究集群主要指 #0 神经科学、#1 外周血管疾病和 #6 多学科科学。截至 2022 年，热门研究集群为 #2 药理学与药学、#3 医学、全科与内科、#5 生物化学与分子生物学和 #7 放射学、核医学与医学成像，这些是缺血性中风病理生理学探索的热点


### 弧线图R语言实战

参考：https://mp.weixin.qq.com/s/-beK8ycxXpbKE8O0nyWpIQ

```{r}
# 加载必要的库
# Load necessary libraries
library(tidyverse)
library(viridis)
library(patchwork)
library(hrbrthemes)
library(igraph)
library(ggraph)
library(colormap)

# 一个非常简单的边列表
# A very simple edge list
links = data.frame(
    source = c("A", "A", "A", "A", "B"),
    target = c("B", "C", "D", "F", "E")
)

# 转换为 igraph 对象
# Convert to igraph object
mygraph <- graph_from_data_frame(links)

# 创建常规网络图
# Create a regular network plot
p1 <- ggraph(mygraph) +
  geom_edge_link(edge_colour = "black", edge_alpha = 0.3, edge_width = 0.2) +
  geom_node_point(color = "#69b3a2", size = 5) +
  geom_node_text(aes(label = name), repel = TRUE, size = 8, color = "#69b3a2") +
  theme_void() +
  theme(
    legend.position = "none",
    plot.margin = unit(rep(2, 4), "cm")
  )

# 创建弧形图
# Create an arc diagram
p2 <- ggraph(mygraph, layout = "linear") +
  geom_edge_arc(edge_colour = "black", edge_alpha = 0.3, edge_width = 0.2) +
  geom_node_point(color = "#69b3a2", size = 5) +
  geom_node_text(aes(label = name), repel = FALSE, size = 8, color = "#69b3a2", nudge_y = -0.1) +
  theme_void() +
  theme(
    legend.position = "none",
    plot.margin = unit(rep(2, 4), "cm")
  )

# 显示两个图并排显示
# Display the two plots side by side
p1 + p2

# 加载数据
# Load data
dataUU <- read.table("https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/13_AdjacencyUndirectedUnweighted.csv", header=TRUE)

# 将邻接矩阵转换为长格式
# Convert adjacency matrix to long format
connect <- dataUU %>%
  gather(key="to", value="value", -1) %>%
  mutate(to = gsub("\\.", " ", to)) %>%
  na.omit()

# 每个人的连接数
# Number of connections per person
c(as.character(connect$from), as.character(connect$to)) %>%
  as.tibble() %>%
  group_by(value) %>%
  summarize(n=n()) -> coauth
colnames(coauth) <- c("name", "n")

# 使用 igraph 创建图对象
# Create graph object using igraph
mygraph <- graph_from_data_frame(connect, vertices = coauth, directed = FALSE)

# 查找社区
# Find communities
com <- walktrap.community(mygraph)

# 重新排序数据集并生成图表
# Reorder dataset and generate plot
coauth <- coauth %>%
  mutate(grp = com$membership) %>%
  arrange(grp) %>%
  mutate(name = factor(name, name))

# 仅保留前 10 个社区
# Keep only the first 10 communities
coauth <- coauth %>%
  filter(grp < 16)

# 仅保留边中存在的这些人
# Keep only those people present in the edges
connect <- connect %>%
  filter(from %in% coauth$name) %>%
  filter(to %in% coauth$name)

# 使用 igraph 创建图对象
# Create graph object using igraph
mygraph <- graph_from_data_frame(connect, vertices = coauth, directed = FALSE)

# 准备 viridis 颜色尺度中的 n 个颜色向量
# Prepare n color vectors from the viridis color scale
mycolor <- colormap(colormap = colormaps$viridis, nshades = max(coauth$grp))
mycolor <- sample(mycolor, length(mycolor))

# 生成图表
# Generate plot
ggraph(mygraph, layout = "linear") +
  geom_edge_arc(edge_colour = "black", edge_alpha = 0.2, edge_width = 0.3, fold = TRUE) +
  geom_node_point(aes(size = n, color = as.factor(grp), fill = grp), alpha = 0.5) +
  scale_size_continuous(range = c(0.5, 8)) +
  scale_color_manual(values = mycolor) +
  geom_node_text(aes(label = name), angle = 65, hjust = 1, nudge_y = -1.1, size = 2.3) +
  theme_void() +
  theme(
    legend.position = "none",
    plot.margin = unit(c(0, 0, 0.4, 0), "null"),
    panel.spacing = unit(c(0, 0, 3.4, 0), "null")
  ) +
  expand_limits(x = c(-1.2, 1.2), y = c(-5.6, 1.2))

# 数据集重新随机排序
# Randomly reorder the dataset
coauth <- coauth %>%
  slice(sample(c(1:nrow(coauth)), nrow(coauth)))

# 使用 igraph 创建图对象
# Create graph object using igraph
mygraph <- graph_from_data_frame(connect, vertices = coauth, directed = FALSE)

# 准备 viridis 颜色尺度中的 n 个颜色向量
# Prepare n color vectors from the viridis color scale
mycolor <- colormap(colormap = colormaps$viridis, nshades = max(coauth$grp))
mycolor <- sample(mycolor, length(mycolor))

# 生成图表
# Generate plot
ggraph(mygraph, layout = "linear") +
  geom_edge_arc(edge_colour = "black", edge_alpha = 0.2, edge_width = 0.3, fold = TRUE) +
  geom_node_point(aes(size = n, color = as.factor(grp), fill = grp), alpha = 0.5) +
  scale_size_continuous(range = c(0.5, 8)) +
  scale_color_manual(values = mycolor) +
  geom_node_text(aes(label = name), angle = 65, hjust = 1, nudge_y = -1.1, size = 2.3) +
  theme_void() +
  theme(
    legend.position = "none",
    plot.margin = unit(c(0, 0, 0.4, 0), "null"),
    panel.spacing = unit(c(0, 0, 3.4, 0), "null")
  ) +
  expand_limits(x = c(-1.2, 1.2), y = c(-5.6, 1.2))

```

