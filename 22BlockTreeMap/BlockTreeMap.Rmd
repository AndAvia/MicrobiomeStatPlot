---
title: "BlockTreeMap"
author: "Defeng Bai Agricultural Genomics Institute at Shenzhen, Chinese Academy of Agricultural Sciences"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: yes
    toc_depth: 5
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo=T, comment=NA, message=F, warning=F,
	fig.align="center", fig.width=5, fig.height=3, dpi=300)
```


## 矩形树图(Tree map)

参考：https://mp.weixin.qq.com/s/cLvQ-fr5l5qDJFoVPZzxAw

树状图由一组矩形组成，这些矩形代表数据中的不同类别，其大小由与各自类别相关的数值定义。例如，一幅树状地图可以显示地球上的大陆，根据它们的人口大小。为了进行更深入的分析，树图可以包括嵌套的矩形，即类别中的类别。在我们的示例中，在每个大陆矩形中，新的矩形可以代表国家及其人口。树状图（treemap）将分层数据显示为一组嵌套矩形。每组由一个矩形表示，该矩形的面积与其数值值成正比。树状图的主要优点之一是，它允许用一张简明的图解释大量的数据。它非常适合显示部分到整体的关系，并突出显示数据中的层次结构。当定义矩形大小的变量变化不大时，不要使用树图。

A treemap consists of a set of rectangles that represent different categories in the data, with sizes defined by the numerical values ​​associated with the respective categories. For example, a treemap could show the continents on Earth, according to the size of their population. For a more in-depth analysis, a treemap can include nested rectangles, i.e. categories within categories. In our example, within each continent rectangle, new rectangles could represent countries and their populations. A treemap displays hierarchical data as a set of nested rectangles. Each group is represented by a rectangle whose area is proportional to its numerical value. One of the main advantages of a treemap is that it allows a large amount of data to be explained with a single concise diagram. It is well suited to showing part-to-whole relationships and highlighting hierarchical structures in the data. Do not use a treemap when the variable defining the size of the rectangles does not vary much.


## 矩形树图案例

这是D. Sean Froese团队2023年发表于Nature Metabolism上的一篇论文用到的图。论文题目为：Integrated multi-omics reveals anapleroticrewiring in methylmalonyl-CoA mutasedeficiency

This is a figure used in a paper published by D. Sean Froese's team in Nature Metabolism in 2023. The title of the paper is: Integrated multi-omics reveals anaplerotic rewiring in methylmalonyl-CoA mutase deficiency

![](e1.BlockTreeMap01.jpg)
Fig. 1i Proportions of affected genes identified in the whole cohort.
图 1i 整个队列中发现的受影响基因的比例。


**结果**
In summary, we found a diagnosis for 177 out of 210 (84%) affected individuals (Fig. 1i), including 150 with deficiency of MMUT and 19 with damaging variants in ACSF3, accounting 
for the largest cohort of ACSF3 deficiency.

综上所述，我们发现 210 名（84%）受影响个体中有 177 名得到诊断（图 1i），其中 150 名患有 MMUT 缺陷，19 名患有 ACSF3 损伤性变异，占 ACSF3 缺陷的最大群体。


## 矩形树图R语言实战
Rectangular Treemap R Language Practice

参考：https://mp.weixin.qq.com/s/1sfaLZ4s50QHVid_HX8L0A
https://mp.weixin.qq.com/s/nf6KNedDIWj1uRWyaPz4pw

```{r Rectangular Treemap, include=TRUE}
#使用treemapify包绘制矩形树状图
#Use the treemapify package to draw a rectangular treemap
# 安装并加载所需的R包
#install.packages("treemapify")
library(treemapify)
library(ggplot2)

# 查看内置示例数据
# check data
head(G20)

# 使用geom_treemap函数绘制矩形树状图
# Use geom_treemap function to draw a rectangular tree map
ggplot(G20, aes(area = gdp_mil_usd, fill = hdi)) +
  geom_treemap()

# 添加label标签，设置字体大小和类型
# Add label tag, set font size and type
ggplot(G20, aes(area = gdp_mil_usd, fill = hdi, label = country)) +
  geom_treemap() +
  geom_treemap_text(fontface = "italic", colour = "white", 
                    size = 16, place = "centre")

# 添加多个分组信息
# add group information
ggplot(G20, aes(area = gdp_mil_usd, fill = hdi,
                label = country,
                subgroup = region)) +
  geom_treemap() +
  geom_treemap_subgroup_border() +
  geom_treemap_subgroup_text(place = "centre", alpha = 0.5, 
                             colour = "black", fontface = "italic") +
  geom_treemap_text(colour = "white", place = "topleft", reflow = T) +
  scale_fill_gradientn(colours = c("blue","white","tomato"))

```
